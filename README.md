# traffic-monitor
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Å—è—á–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ —á–µ—Ä–µ–∑ `vnstat` —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ Telegram –∏–ª–∏ ntfy.sh<br><br>
–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –≤ cron —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏—à–ª–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü.<br><br>
–ï—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç—á–µ—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Å–≤–æ–¥–∫—É —Å—É–º–º–∞—Ä–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü (–∏ —Ä–∞–∑–Ω–∏—Ü—É –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–æ—à–ª—ã–º –æ—Ç—á–µ—Ç–æ–º).

<img src="https://raw.githubusercontent.com/aiovin/traffic-monitor/refs/heads/main/warning.png" height="90px"> <img src="https://raw.githubusercontent.com/aiovin/traffic-monitor/refs/heads/main/report2.jpg" height="95px">

## üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ –ª—é–±–æ–µ —É–¥–æ–±–Ω–æ–µ –º–µ—Å—Ç–æ –∏ —Å–¥–µ–ª–∞–π—Ç–µ –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
curl -o traffic-monitor.sh https://raw.githubusercontent.com/aiovin/traffic-monitor/refs/heads/main/traffic-monitor.sh
```

```bash
chmod +x traffic-monitor.sh
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```
LIMIT="500 GiB"                  # –õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "100 GiB" –∏–ª–∏ "1 TiB")
WARNING_THRESHOLD_PERCENT=90     # –ü–æ—Ä–æ–≥ —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

MSG_TYPE="tg"                    # –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (tg/ntfy)

BOT_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω"            # Telegram —Ç–æ–∫–µ–Ω
CHAT_ID="–≤–∞—à_chat_id"            # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—á–∞—Ç–∞

NTFY_TOPIC="–≤–∞—à_—Ç–æ–ø–∏–∫"           # –í–∞—à ntfy —Ç–æ–ø–∏–∫
```
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –º–æ–∂–Ω–æ –Ω–µ –∑–∞–ø–æ–ª–Ω—è—Ç—å.

## üìÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron
–î–æ–±–∞–≤—å—Ç–µ –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –≤ cron (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

```
crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É

```
*/5 * * * * /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/—Å–∫—Ä–∏–ø—Ç—É/traffic-monitor.sh >> /var/tmp/traffic_monitor.log 2>&1
```

> [!TIP]
> –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞ (`-report`) –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –≤ cron
> 
> –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –≤ 12 –Ω–æ—á–∏
> ```
> 0 0 * * * /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/—Å–∫—Ä–∏–ø—Ç—É/traffic-monitor.sh -report >> /var/tmp/traffic_monitor.log 2>&1
> ```
> –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π (–í 00:00 –∫–∞–∂–¥–æ–≥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞)
> ```
> 0 0 * * 1 /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/—Å–∫—Ä–∏–ø—Ç—É/traffic-monitor.sh -report >> /var/tmp/traffic_monitor.log 2>&1
> ```
> –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π (–í 23:00 –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞)
> ```
> 0 23 28-31 * * [ "$(date +\%d -d tomorrow)" = "01" ] && /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/—Å–∫—Ä–∏–ø—Ç—É/traffic-monitor.sh -report monthly >> /var/tmp/traffic_monitor.log 2>&1
> ```
>
> #### –î–ª—è —á–µ–≥–æ -report monthly?
> –í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ `-report` —Ä–∞–∑–Ω–∏—Ü–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ (–∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–∫–æ–±–∫–∞—Ö) —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç—á–µ—Ç–∞. –ù–∞ —Å—Ç—ã–∫–µ –º–µ—Å—è—Ü–µ–≤ —ç—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –¥–∞–Ω–Ω—ã–º: –Ω–∞–ø—Ä–∏–º–µ—Ä, 31-–≥–æ —á–∏—Å–ª–∞ –æ–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å 1 –¢–ë, –∞ 1-–≥–æ —á–∏—Å–ª–∞ ‚Äî –≤—Å–µ–≥–æ 2 –ì–ë (–∏–∑-–∑–∞ —Å–±—Ä–æ—Å–∞ —Å—á—ë—Ç—á–∏–∫–∞), —á—Ç–æ –≤—ã–∑–æ–≤–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—É—é —Ä–∞–∑–Ω–∏—Ü—É. –ü–æ—ç—Ç–æ–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–µ—Ä–≤—ã–π –æ—Ç—á—ë—Ç –º–µ—Å—è—Ü–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É.
>
> –û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –æ—Ç—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è <b>—Ä–∞–∑ –≤ –º–µ—Å—è—Ü</b>, —Ä–∞–∑–Ω–∏—Ü–∞ –≤–æ–æ–±—â–µ –Ω–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç—á—ë—Ç –±—ã–ª –≤ –ø—Ä–æ—à–ª–æ–º –º–µ—Å—è—Ü–µ.
>
> –í —Ä–µ–∂–∏–º–µ `-report monthly` —Ä–∞–∑–Ω–∏—Ü–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è <b>–¥–∞–∂–µ –º–µ–∂–¥—É –º–µ—Å—è—Ü–∞–º–∏</b>, —á—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ ‚Äî –≤—ã –≤—Å–µ–≥–¥–∞ —É–≤–∏–¥–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞.

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```
traffic-monitor.sh [–æ–ø—Ü–∏–∏]
```

| –ö–ª—é—á             | –û–ø–∏—Å–∞–Ω–∏–µ                                                              |
| ---------------- | --------------------------------------------------------------------- |
| `-host –∏–º—è`      | –£–∫–∞–∑–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∏–º—è —Ö–æ—Å—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π                    |
| `-reset`         | –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –∏ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ—à–ª–æ–≥–æ –æ—Ç—á–µ—Ç–∞  |
| `-report` | –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞–∑–æ–≤–æ —Å–≤–æ–¥–∫—É –ø–æ —Ç—Ä–∞—Ñ–∏–∫—É –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –∏ —Ä–∞–∑–Ω–∏—Ü—É —Å —Ç—Ä–∞—Ñ–∏–∫–æ–º –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –∑–∞–º–µ—Ä–∞ (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–º –º–µ—Å—è—Ü–µ)    |
| `-report monthly` | –í –Ω–æ–≤–æ–º –º–µ—Å—è—Ü–µ –Ω–µ –æ—á–∏—Å—Ç–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –æ –∑–∞–º–µ—Ä–µ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞    |
| `-report clean` | –í –æ—Ç—á–µ—Ç–µ –Ω–µ –ø—Ä–∏—Å—ã–ª–∞—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç—Ä–∞—Ñ–∏–∫–æ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç—á–µ—Ç–∞    |
| `-debug`         | –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å—á—ë—Ç—ã –∏ —Å—Ç–∞—Ç—É—Å—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π) |
| `-month –ì–ì–ì–ì-–ú–ú` | –ó–∞–¥–∞—Ç—å "—Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü" –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞    |
| `-test` | –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ    |
| `-limit –ª–∏–º–∏—Ç` | –ó–∞–¥–∞—Ç—å –ª–∏–º–∏—Ç    |
| `-msgtype —Ç–∏–ø` | –ó–∞–¥–∞—Ç—å —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π    |
| `-threshold –ø–æ—Ä–æ–≥` | –ó–∞–¥–∞—Ç—å –ø–æ—Ä–æ–≥ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è    |

> [!TIP]
> - –ò–º—è —Ö–æ—Å—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ `$(hostname)`, –µ—Å–ª–∏ –º–µ–Ω—è–µ—Ç–µ –Ω–∞ –¥—Ä—É–≥–æ–µ —Ñ–ª–∞–≥–æ–º `-host` —Ç–æ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –µ–≥–æ –¥–æ–±–∞–≤–∏—Ç—å –∏ –≤ –∫–æ–º–∞–Ω–¥–µ –∑–∞–ø—É—Å–∫–∞ –≤ cron.
> - –î–ª—è —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ—à–ª–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–¥–∏–Ω–æ–∂–¥—ã —Å —Ñ–ª–∞–≥–æ–º `-reset`.

### –§–∞–π–ª –ª–æ–≥–æ–≤

```
/var/tmp/traffic_monitor.log
```
